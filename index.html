<!DOCTYPE html>
<html>
<head>
    <title>Opening Obsidian...</title>
    <meta charset="utf-8">
    <script>
        window.onload = function() {
            // THE FIX: Do not use URLSearchParams (it breaks at '&')
            // Instead, we manually grab everything after 'link='
            const url = window.location.href;
            
            if (url.includes('link=')) {
                // Split the URL at 'link=' and take the second part
                // decodeURIComponent ensures %20 turns back into spaces if needed
                const rawTarget = url.split('link=')[1];
                const target = decodeURIComponent(rawTarget);

                if (target && target.startsWith('obsidian://')) {
                    window.location.href = target;
                    
                    setTimeout(() => {
                        window.close();
                    }, 3000);
                } else {
                    document.body.innerHTML = "‚ùå Error: Invalid Obsidian link.";
                }
            } else {
                 document.body.innerHTML = "‚ùå Error: No link parameter found.";
            }
        }
    </script>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; }
    </style>
</head>
<body>
    <h2>üöÄ Launching Obsidian...</h2>
    <p>If it doesn't open automatically, <a id="manual" href="#">click here</a>.</p>
    <script>
        // Make the manual link work just in case
        const params = new URLSearchParams(window.location.search);
        const target = params.get('link');
        if (target) document.getElementById('manual').href = target;
    </script>
</body>

</html>
